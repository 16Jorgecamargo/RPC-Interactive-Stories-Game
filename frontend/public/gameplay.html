<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo em Andamento - RPC Interactive Stories</title>
  <script src="/config.js"></script>
  <link rel="stylesheet" href="/src/styles/gameplay.css">
</head>
<body>
  <div class="container">
    <div class="session-header card">
      <h1 id="storyTitle">Carregando...</h1>
      <p id="sessionName">Carregando sess√£o...</p>
      <button id="leaveBtn" class="btn btn-danger">Sair da Sess√£o</button>
    </div>

    <div class="game-layout">
      <!-- √Årea Principal - Hist√≥ria e Op√ß√µes -->
      <div class="main-area">
        <div class="story-card card">
          <h2>Hist√≥ria</h2>
          <div id="storyText" class="story-text">
            Carregando cap√≠tulo atual...
          </div>

          <div id="combatView" class="combat-view" style="display: none;">
            <div class="combat-status">
              <div class="combat-status-column">
                <h4>Grupo</h4>
                <div id="combatAllies" class="combat-entity-grid"></div>
              </div>
              <div class="combat-status-column">
                <h4>Inimigos</h4>
                <div id="combatEnemies" class="combat-entity-grid"></div>
              </div>
            </div>

            <div id="combatActions" class="combat-actions"></div>
          </div>

          <!-- Overlay de Resultado da Vota√ß√£o -->
          <div id="votingResultOverlay" class="voting-result-overlay" style="display: none;">
            <div class="voting-result-card card">
              <h3>Resultado da Vota√ß√£o</h3>
              <p id="votingResultChoice" class="voting-result-choice"></p>
              <p id="votingResultMethod" class="voting-result-method"></p>
              <p id="votingResultDetails" class="voting-result-details"></p>
              <div id="votingResultProgress" class="voting-progress-bar voting-result-progress">
                <div id="votingResultProgressFill" class="voting-progress-fill"></div>
              </div>
              <p id="votingResultCountdown" class="voting-result-countdown">Continuando em 5s...</p>
            </div>
          </div>

          <!-- Overlay de Bloqueio quando Jogador Offline -->
          <div id="offlineWarningOverlay" class="offline-warning-overlay" style="display: none;">
            <div class="offline-warning-card card">
              <h3>‚ö†Ô∏è Aguardando Aventureiros</h3>
              <p>Todos os usu√°rios precisam ficar conectados na sess√£o para continuar</p>
              <div id="offlinePlayersList" class="offline-players-list"></div>
            </div>
          </div>

          <!-- Barra de Progresso do Timer -->
          <div id="votingProgressBar" class="voting-progress-bar" style="display: none;">
            <div class="voting-progress-fill"></div>
          </div>

          <div id="optionsContainer" class="options-container">
            <!-- Op√ß√µes ser√£o renderizadas aqui -->
          </div>

          <div id="votingStatus" class="voting-status" style="display: none;">
            <h3>Status da Vota√ß√£o</h3>
            <div id="votingInfo"></div>
            <div id="votingTimer" class="voting-timer"></div>
          </div>
        </div>
      </div>

      <!-- √Årea Lateral Direita -->
      <div class="sidebar">
        <!-- Lista de Personagens -->
        <div class="characters-card card">
          <h3>Personagens</h3>
          <div id="charactersList" class="characters-list">
            <!-- Personagens ser√£o renderizados aqui -->
          </div>
        </div>

        <!-- Chat -->
        <div class="chat-card card">
          <h3>Chat</h3>
          <div id="chatMessages" class="chat-messages">
            <!-- Mensagens do chat -->
          </div>
          <div class="chat-input">
            <input
              type="text"
              id="messageInput"
              placeholder="Digite sua mensagem..."
              onkeydown="handleEnter(event)"
              maxlength="500"
            >
            <button id="sendMessageBtn" class="btn" style="padding: 10px 15px;">üì§</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dialog de Visualiza√ß√£o de Personagem -->
  <div id="characterDialog" class="dialog-overlay">
    <div class="dialog">
      <button class="dialog-close" onclick="closeCharacterDialog()">&times;</button>
      <div class="dialog-header">
        <h2 id="charName">Nome do Personagem</h2>
        <p id="charRaceClass">Ra√ßa ‚Ä¢ Classe</p>
      </div>
      <div class="dialog-content">
        <h4>Atributos</h4>
        <ul id="charAttributes"></ul>

        <h4>Estat√≠sticas de Combate</h4>
        <ul id="charCombatStats"></ul>

        <div id="charMetaSection" style="display: none;">
          <h4>Detalhes</h4>
          <ul id="charDetails"></ul>
        </div>

        <div id="charProficienciesSection" style="display: none;">
          <h4>Profici√™ncias</h4>
          <div id="charProficiencies"></div>
        </div>

        <div id="charAttacksSection" style="display: none;">
          <h4>Ataques</h4>
          <ul id="charAttacks"></ul>
        </div>

        <div id="charSpellsSection" style="display: none;">
          <h4>Magias</h4>
          <ul id="charSpells"></ul>
        </div>

        <h4>Hist√≥ria</h4>
        <div id="charBackground"></div>

        <div id="charFeatureSection" style="display: none;">
          <h4>Caracter√≠sticas Especiais</h4>
          <div id="charFeature"></div>
        </div>

        <h4>Equipamento</h4>
        <ul id="charEquipment"></ul>
      </div>
    </div>
  </div>

  <!-- Overlay de Transi√ß√£o para Combate -->
  <div id="combatTransitionOverlay" class="dialog-overlay" style="display: none;">
    <div class="dialog transition-dialog">
      <div class="transition-header">
        <h2>Preparando Combate</h2>
        <p>Os advers√°rios est√£o se posicionando...</p>
      </div>
      <div class="transition-progress">
        <div id="combatTransitionProgressFill" class="transition-progress-fill"></div>
      </div>
    </div>
  </div>

  <!-- Overlay de Iniciativa de Combate -->
  <div id="combatInitiativeOverlay" class="dialog-overlay" style="display: none;">
    <div class="dialog initiative-dialog">
      <div class="dialog-header">
        <h2>Rolando Iniciativa</h2>
        <p class="initiative-subtitle">Prepare-se! Cada jogador lan√ßa um d20 para definir a ordem.</p>
      </div>
      <div id="initiativePlayers" class="initiative-grid"></div>
      <div id="initiativeFinalOrder" class="initiative-final-order" style="display: none;">
        <h3>Ordem Final</h3>
        <ol id="initiativeOrderList"></ol>
        <p class="initiative-countdown">Iniciando combate em <span id="initiativeCountdown">5</span>s...</p>
      </div>
    </div>
  </div>

  <!-- Overlay de A√ß√µes do Inimigo -->
  <div id="enemyActionOverlay" class="dialog-overlay" style="display: none;">
    <div class="dialog enemy-action-dialog">
      <div class="dialog-header">
        <h2 id="enemyActionTitle">Inimigo em movimento</h2>
      </div>
      <div class="dialog-content">
        <p id="enemyActionDescription" class="enemy-action-description">Os inimigos est√£o planejando seu pr√≥ximo passo...</p>
        <div class="enemy-action-progress">
          <div id="enemyActionProgressFill" class="enemy-action-progress-fill"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de A√ß√£o de Combate -->
  <div id="combatActionModal" class="dialog-overlay" style="display: none;">
    <div class="dialog combat-action-dialog">
      <button class="dialog-close" id="combatActionClose">&times;</button>
      <div class="dialog-header">
        <h2 id="combatActionTitle">Escolher Ataque</h2>
      </div>
      <div class="dialog-content">
        <div id="combatActionAttacks" class="action-list"></div>
        <div id="combatActionSpells" class="action-list" style="display: none;"></div>
        <div id="combatActionTargets" class="action-targets"></div>
      </div>
      <div class="dialog-footer">
        <button id="confirmCombatAction" class="btn btn-primary" disabled>Confirmar</button>
        <button id="cancelCombatAction" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Overlay de Anima√ß√£o de Ataque D20 -->
  <div id="attackAnimationOverlay" class="dialog-overlay" style="display: none;">
    <div class="dialog attack-animation-dialog">
      <div class="dialog-header">
        <h2 id="attackAnimationTitle">Rolando Ataque</h2>
      </div>
      <div class="attack-animation-content">
        <div class="attack-info">
          <p id="attackerInfo" class="attacker-name"></p>
          <p id="targetInfo" class="target-name"></p>
        </div>
        <div class="dice-roll-display">
          <div id="attackDiceRoll" class="dice-display rolling">--</div>
          <p id="attackRollFormula" class="roll-formula">D20 + Modificador</p>
        </div>
        <div id="attackResult" class="attack-result" style="display: none;">
          <p id="attackResultText" class="result-text"></p>
          <div id="damageRollSection" class="damage-section" style="display: none;">
            <div id="damageDiceRoll" class="dice-display damage-dice rolling">--</div>
            <p id="damageRollFormula" class="roll-formula"></p>
            <p id="damageTotal" class="damage-total"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Aba Bloqueada -->
  <div id="tabBlockedModal" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-header">
        <h2>‚ö†Ô∏è Sess√£o Aberta em Outra Aba</h2>
      </div>
      <div class="dialog-content" style="text-align: center;">
        <p style="font-size: 1.1rem; margin-bottom: 20px;">
          Voc√™ abriu esta sess√£o em outra aba ou janela. Por favor, feche esta aba e use a outra para evitar conflitos.
        </p>
        <p style="color: var(--secondary-gold); font-style: italic;">
          Esta p√°gina est√° inativa e n√£o receber√° atualiza√ß√µes.
        </p>
      </div>
    </div>
  </div>

  <script type="module" src="/src/ui/game/gameplay.js"></script>
</body>
</html>
