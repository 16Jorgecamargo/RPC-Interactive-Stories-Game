<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Personagem - RPC Interactive Stories</title>
    <script src="/config.js"></script>
    <link rel="stylesheet" href="/src/styles/character-form.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1 id="storyName">‚öîÔ∏è Criar Personagem</h1>
                <p style="color: var(--primary-gold); font-style: italic; margin: 0;" id="storyDescription">
                    "Forje sua lenda e prepare-se para a aventura"
                </p>
            </div>

            <div class="progress-bar">
                <div class="progress-step active" data-step="1">
                    <div class="progress-number">1</div>
                    <div class="progress-label">Nome</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="progress-number">2</div>
                    <div class="progress-label">Ra√ßa</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="progress-number">3</div>
                    <div class="progress-label">Classe</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="progress-number">4</div>
                    <div class="progress-label">Atributos</div>
                </div>
                <div class="progress-step" data-step="5">
                    <div class="progress-number">5</div>
                    <div class="progress-label">Hist√≥ria</div>
                </div>
                <div class="progress-step" data-step="6">
                    <div class="progress-number">6</div>
                    <div class="progress-label">Magias &amp; Ataques</div>
                </div>
                <div class="progress-step" data-step="7">
                    <div class="progress-number">7</div>
                    <div class="progress-label">Combate</div>
                </div>
                <div class="progress-step" data-step="8">
                    <div class="progress-number">8</div>
                    <div class="progress-label">Revis√£o</div>
                </div>
            </div>

            <form id="characterForm">
                <div class="form-content">
                    <div id="errorMessage" class="error-message"></div>

                    <!-- Step 1: Nome -->
                    <div class="wizard-step active" data-step="1">
                        <h2>üìú Nome do Personagem</h2>
                        <p class="step-subtitle">
                            Comece definindo como seu her√≥i ser√° conhecido na aventura.
                        </p>
                        <div class="input-group">
                            <label for="characterName">üè∑Ô∏è Nome</label>
                            <input type="text" id="characterName" minlength="3" maxlength="50" placeholder="Ex: Thorin Escudo de Carvalho" required>
                            <small>M√≠nimo de 3 e m√°ximo de 50 caracteres.</small>
                        </div>
                    </div>

                    <!-- Step 2: Ra√ßa -->
                    <div class="wizard-step" data-step="2">
                        <h2>üßù Escolha sua Ra√ßa</h2>
                        <p class="step-subtitle">
                            As ra√ßas definem apar√™ncia, idiomas, velocidade e b√¥nus de atributos. Consulte os tra√ßos antes de decidir.
                        </p>
                        <div id="racesGrid" class="options-grid"></div>
                    </div>

                    <!-- Step 3: Classe -->
                    <div class="wizard-step" data-step="3">
                        <h2>‚öîÔ∏è Escolha sua Classe</h2>
                        <p class="step-subtitle">
                            A classe define habilidades, magias e equipamento padr√£o do personagem.
                        </p>
                        <div id="classesGrid" class="options-grid"></div>
                    </div>

                    <!-- Step 4: Atributos -->
                    <div class="wizard-step" data-step="4">
                        <h2>üìä Distribua os Atributos</h2>
                        <p class="step-subtitle">
                            Utilize o sistema point buy (27 pontos). Os b√¥nus raciais ser√£o aplicados automaticamente aos totais.
                        </p>
                        <div class="point-buy-counter">
                            <span>Pontos usados:</span>
                            <span id="pointsUsed" class="points-value">0</span>
                            <span>/ 27</span>
                        </div>

                        <div class="attributes-grid">
                            <div class="attribute-group">
                                <label>üí™ For√ßa</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="strength-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="strength-bonus">+0</span>
                                    <span class="attr-total" id="strength-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                            <div class="attribute-group">
                                <label>üèÉ Destreza</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="dexterity-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="dexterity-bonus">+0</span>
                                    <span class="attr-total" id="dexterity-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                            <div class="attribute-group">
                                <label>‚ù§Ô∏è Constitui√ß√£o</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="constitution-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="constitution-bonus">+0</span>
                                    <span class="attr-total" id="constitution-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                            <div class="attribute-group">
                                <label>üß† Intelig√™ncia</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="intelligence-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="intelligence-bonus">+0</span>
                                    <span class="attr-total" id="intelligence-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                            <div class="attribute-group">
                                <label>üîÆ Sabedoria</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="wisdom-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="wisdom-bonus">+0</span>
                                    <span class="attr-total" id="wisdom-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                            <div class="attribute-group">
                                <label>‚ú® Carisma</label>
                                <div class="attribute-breakdown">
                                    <input type="number" id="charisma-base" class="attr-base" min="8" max="15" value="8" required>
                                    <span class="attr-bonus" id="charisma-bonus">+0</span>
                                    <span class="attr-total" id="charisma-total">8</span>
                                </div>
                                <small>Base | B√¥nus | Total</small>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Hist√≥ria -->
                    <div class="wizard-step" data-step="5">
                        <h2>üß≠ Hist√≥ria do Personagem</h2>
                        <p class="step-subtitle">
                            Construa a personalidade, tra√ßos marcantes e objetivos do seu her√≥i. Esses pontos ser√£o usados apenas na narrativa.
                        </p>
                        <div class="step-section">
                            <h3 class="step-title">üìñ Detalhes Narrativos</h3>
                            <div class="grid grid-2">
                                <div class="input-group">
                                    <label for="appearance">üë§ Apar√™ncia</label>
                                    <textarea id="appearance" rows="3" minlength="10" maxlength="500" placeholder="Descreva a apar√™ncia f√≠sica do personagem" required></textarea>
                                </div>
                                <div class="input-group">
                                    <label for="personality">üòä Personalidade</label>
                                    <textarea id="personality" rows="3" minlength="10" maxlength="500" placeholder="Como o personagem se comporta?" required></textarea>
                                </div>
                            </div>
                            <div class="grid grid-2">
                                <div class="input-group">
                                    <label for="fears">üò∞ Medos</label>
                                    <textarea id="fears" rows="2" minlength="10" maxlength="500" placeholder="Quais receios guiam o personagem?" required></textarea>
                                </div>
                                <div class="input-group">
                                    <label for="goals">üéØ Objetivos</label>
                                    <textarea id="goals" rows="2" minlength="10" maxlength="500" placeholder="Quais metas ele deseja alcan√ßar?" required></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Magias & Ataques -->
                    <div class="wizard-step" data-step="6">
                        <h2>‚öîÔ∏è Ataques e Magias</h2>
                        <p class="step-subtitle">
                            Selecione as op√ß√µes que melhor representam o estilo do personagem. Os limites variam conforme a classe escolhida.
                        </p>

                        <div class="step-section">
                            <h3 class="step-title">üó°Ô∏è Ataques Simples</h3>
                            <p class="step-hint">Ataques baseados na arma da classe. N√£o consomem recursos e podem ser usados livremente.</p>
                            <div class="spell-counter">
                                <span>Selecionados:</span>
                                <span id="attacksSelected" class="points-value">0</span>
                                <span>/</span>
                                <span id="attacksMax" class="points-value">0</span>
                            </div>
                            <div id="attacksGrid" class="spells-grid"></div>
                        </div>

                        <div class="step-section" id="magicSection">
                            <h3 class="step-title">üîÆ Magias T√°ticas</h3>
                            <p class="step-hint">Magias poderosas que causam efeitos adicionais. Cada magia possui um limite de usos.</p>
                            <div class="spell-counter">
                                <span>Selecionadas:</span>
                                <span id="spellsSelected" class="points-value">0</span>
                                <span>/</span>
                                <span id="spellsMax" class="points-value">0</span>
                            </div>
                            <div id="spellsGrid" class="spells-grid"></div>
                        </div>
                    </div>

                    <!-- Step 7: Estat√≠sticas de Combate -->
                    <div class="wizard-step" data-step="7">
                        <h2>‚ù§Ô∏è Estat√≠sticas de Combate</h2>
                        <p class="step-subtitle">
                            Estes valores s√£o calculados automaticamente com base nos atributos, equipamentos e classe. Revise antes de prosseguir.
                        </p>

                        <div class="combat-stats-grid">
                            <div class="stat-card">
                                <span class="stat-label">Classe de Armadura</span>
                                <span class="stat-value" id="statArmorClass">--</span>
                                <small id="statArmorSource"></small>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Iniciativa</span>
                                <span class="stat-value" id="statInitiative">--</span>
                                <small>Modificador de Destreza</small>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Deslocamento</span>
                                <span class="stat-value" id="statSpeed">--</span>
                                <small>Baseado na ra√ßa</small>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Dados de Vida</span>
                                <span class="stat-value" id="statHitDice">--</span>
                                <small>Informado pela classe</small>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">PV M√°ximos</span>
                                <span class="stat-value" id="statMaxHp">--</span>
                                <small>Hit Die + modificador de Constitui√ß√£o</small>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">PV Atuais</span>
                                <span class="stat-value" id="statCurrentHp">--</span>
                                <small>Inicia igual aos PV m√°ximos</small>
                            </div>
                        </div>
                    </div>

                    <!-- Step 8: Revis√£o -->
                    <div class="wizard-step" data-step="8">
                        <h2>‚úÖ Revis√£o Final</h2>
                        <p class="step-subtitle">
                            Confira o resumo consolidado. Retorne √†s etapas anteriores para ajustar qualquer detalhe.
                        </p>

                        <div id="reviewSummary" class="review-summary">
                            <!-- preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <div class="flex" style="gap: 15px;">
                        <button type="button" class="btn btn-secondary" id="prevBtn" style="flex: 1;" disabled>‚Üê Voltar</button>
                        <button type="button" class="btn btn-secondary" id="cancelBtn" style="flex: 1;">‚ùå Cancelar</button>
                        <button type="button" class="btn" id="nextBtn" style="flex: 1;">Pr√≥ximo ‚Üí</button>
                        <button type="submit" class="btn" id="submitBtn" style="flex: 1; display: none;">
                            <span id="submitText">‚ú® Criar Personagem</span>
                            <span id="submitLoader" class="loading-spinner" style="display: none;"></span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="cancelDialog" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <h2 style="color: var(--primary-gold); text-align: center; margin-bottom: 15px;">‚ö†Ô∏è Cancelar Cria√ß√£o?</h2>
            <p style="color: var(--parchment); text-align: center; margin-bottom: 25px;">
                Todos os dados inseridos ser√£o perdidos. Tem certeza de que deseja cancelar?
            </p>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelDialogNo" style="flex: 1;">N√£o, continuar</button>
                <button type="button" class="btn" id="cancelDialogYes" style="flex: 1; background: linear-gradient(145deg, var(--dark-red), #660000);">
                    Sim, cancelar
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="/src/ui/characters/character-form.js"></script>
</body>
</html>
